## 开发语言：
PHP
## 项目描述：
开发电商平台，接入第三方支付必不可少。本项目旨在提供接入第三方支付时服务端代码的参考。
## 如何接入支付
  不同支付渠道的接入方式大致相同，商户提交申请，签约开通支付平台，获得key，开发，测试，上线。

  开发包括前端代码和后端代码，前端一般负责把必要的订单参数（商品名称、商品描述、总价和购买者信息等）提交给服务端，服务端根据不同的平台，构建支付请求并返回给前端，返回结果可能是一个form表单、一个URL或者一些必要参数（如微信中的prepayid），这些参数中一般会含有签名的字段，前端可以提交form表单、请求URL或者调用app的SDK，完成支付。

  完成支付后，一般会包括两个通知：**跳转**和**异步通知**。

跳转就是支付完成后，浏览器自动跳转或点击“支付完成”后跳转到指定的页面，大多数支付平台允许用户指定这个跳转页面的URL。一般把订单详情页或者订单列表等页面作为这个跳转URL。支付平台一般请求这个跳转URL的时候，还会带有关于支付结果的参数，告知用户是否支付成功。

异步通知就是支付平台给商户server发送的关于支付结果的通知，一般都是POST请求。此时server端根据支付结果来更新订单的状态、提醒发货、减小库存数量等操作。由于网络的不可靠，为了让商户能确实收到支付结果通知，多数平台都提供重复通知的功能。这就要求商户server一切处理正常后要给支付平台一个处理结果：“我已经处理完了，不要通知我了”。支付平台如果没收到这个通知，那就会多次通知，直至满足一定的条件（比如通知次数达到设定值，或者超时）。

* 关于支付通知处理

为了防止有人冒充支付平台给商户发送通知，对商户造成损失。商户的server必须对发来的通知进行**验签**。验签就是为了证明这个通知确实来自支付平台。
既然支付平台这么负责任，会多次通知，那么就会存在商户server多次调用处理订单的方法，万一重复发货，那么不是亏大了。所以商户的server处理异步通知的方法一定要具有**幂等性**。

### 名词解释
1. 支付平台
目前主流的支付渠道包括：支付宝、微信支付、银联、京东支付、易宝支付等
2. 支付渠道
同一个支付渠道，包括多个支付平台，如支付宝包括PC端支付、WAP、APP等，微信包括APP、扫码和WAP等
3. key
签约后支付平台给商家的密钥，用于对数据进行加密或对第三方支付平台返回数据进行验证，有的平台会给一个随机字符串，有的提供RSA 公钥和密钥对。


## 联系作者
* 邮箱：luerfeng2012@gmail.com
* QQ: 420674987